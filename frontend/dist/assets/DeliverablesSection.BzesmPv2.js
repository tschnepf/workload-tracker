import{j as e}from"./query.D2_a4YYZ.js";import{r as i}from"./react-vendor.BaVwoRKI.js";import{f as N}from"./api.BBwiE9lX.js";import"./router.BYkwE9TY.js";const H=({project:t})=>{const[u,r]=i.useState([]),[x,p]=i.useState(!1),[d,b]=i.useState(null),[f,j]=i.useState(!1),[v,m]=i.useState(null),[g,h]=i.useState(null),[y,a]=i.useState(null);i.useEffect(()=>{t.id&&n()},[t.id]);const n=async()=>{if(t.id)try{j(!0),m(null);const s=await N.list(t.id);r(s.results||[])}catch(s){m("Failed to load deliverables"),console.error("Failed to load deliverables:",s)}finally{j(!1)}},D=()=>{p(!0)},l=async s=>{if(t.id)try{await N.create({project:t.id,...s}),await n(),p(!1)}catch{m("Failed to create deliverable")}},w=async(s,c)=>{try{await N.update(s,c),await n(),b(null)}catch{m("Failed to update deliverable")}},S=async s=>{if(confirm("Are you sure you want to delete this deliverable?"))try{await N.delete(s),await n()}catch{m("Failed to delete deliverable")}},k=s=>{h(s)},E=(s,c)=>{s.preventDefault(),a(c)},A=()=>{a(null)},I=async(s,c)=>{if(s.preventDefault(),g===null||g===c){h(null),a(null);return}const o=[...u],[O]=o.splice(g,1);o.splice(c,0,O),r(o),h(null),a(null);try{const C=o.map(T=>T.id);await N.reorder(t.id,C)}catch{m("Failed to reorder deliverables"),await n()}},F=()=>{h(null),a(null)};return e.jsxs("div",{className:"border-t border-[#3e3e42] pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-base font-semibold text-[#cccccc]",children:"Deliverables"}),e.jsx("button",{onClick:D,className:"px-2 py-0.5 text-xs rounded border bg-[#3e3e42] border-[#3e3e42] text-[#cccccc] hover:bg-[#4e4e52] hover:text-[#cccccc] transition-colors",children:"+ Add Deliverable"})]}),v&&e.jsx("div",{className:"mb-2 p-2 bg-red-500/20 border border-red-500/50 rounded text-red-400 text-xs",children:v}),f?e.jsx("div",{className:"text-center py-4 text-[#969696] text-sm",children:"Loading deliverables..."}):u.length===0&&!x?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"No deliverables yet"}),e.jsx("div",{className:"text-[#969696] text-xs mt-1",children:'Click "Add Deliverable" to get started'})]}):e.jsx("div",{className:"space-y-1",children:u.map((s,c)=>e.jsx($,{deliverable:s,index:c,editing:d===s.id,isDragged:g===c,isDraggedOver:y===c,onEdit:()=>b(s.id),onSave:o=>w(s.id,o),onCancel:()=>b(null),onDelete:()=>S(s.id),onDragStart:()=>k(c),onDragOver:o=>E(o,c),onDragLeave:A,onDrop:o=>I(o,c),onDragEnd:F},s.id))}),x&&e.jsx(L,{onSave:l,onCancel:()=>p(!1)})]})},$=({deliverable:t,index:u,editing:r,isDragged:x,isDraggedOver:p,onEdit:d,onSave:b,onCancel:f,onDelete:j,onDragStart:v,onDragOver:m,onDragLeave:g,onDrop:h,onDragEnd:y})=>{const[a,n]=i.useState({percentage:t.percentage,description:t.description||"",date:t.date,notes:t.notes||"",isCompleted:t.isCompleted||!1});i.useEffect(()=>{r&&n({percentage:t.percentage,description:t.description||"",date:t.date,notes:t.notes||"",isCompleted:t.isCompleted||!1})},[t,r]);const D=()=>e.jsxs("div",{className:"cursor-grab active:cursor-grabbing flex flex-col justify-center items-center w-4 h-4 mr-2",onMouseDown:v,children:[e.jsx("div",{className:"w-3 h-0.5 bg-[#969696] mb-0.5"}),e.jsx("div",{className:"w-3 h-0.5 bg-[#969696] mb-0.5"}),e.jsx("div",{className:"w-3 h-0.5 bg-[#969696]"})]});return r?e.jsxs("div",{className:"p-2 bg-[#3e3e42]/50 rounded border border-[#3e3e42]",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-2 items-center text-xs mb-2",children:[e.jsx("div",{className:"text-[#969696] font-medium w-4"})," ",e.jsx("div",{className:"text-[#969696] font-medium",children:"%"}),e.jsx("div",{className:"text-[#969696] font-medium",children:"DESCRIPTION"}),e.jsx("div",{className:"text-[#969696] font-medium",children:"DATE"}),e.jsx("div",{className:"text-[#969696] font-medium",children:"NOTES"}),e.jsx("div",{className:"text-[#969696] font-medium",children:"ACTIONS"})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-2 items-start",children:[e.jsx("div",{className:"w-4"}),e.jsx("input",{type:"number",min:"0",max:"100",value:a.percentage||"",onChange:l=>n({...a,percentage:l.target.value?Number(l.target.value):null}),placeholder:"%",className:"px-1 py-0.5 bg-[#2d2d30] border border-[#3e3e42] rounded text-[#cccccc] text-xs [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]"}),e.jsx("input",{type:"text",value:a.description,onChange:l=>n({...a,description:l.target.value}),placeholder:"Description",className:"px-1 py-0.5 bg-[#2d2d30] border border-[#3e3e42] rounded text-[#cccccc] text-xs"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:a.date||"",onChange:l=>n({...a,date:l.target.value||null}),className:"px-1 py-0.5 bg-[#2d2d30] border border-[#3e3e42] rounded text-[#cccccc] text-xs w-full pr-5"}),a.date&&e.jsx("button",{onClick:()=>n({...a,date:null}),className:"absolute right-0.5 top-0 bottom-0 px-1 text-red-400 hover:text-red-300 text-xs",children:"×"})]}),e.jsx("input",{type:"text",value:a.notes,onChange:l=>n({...a,notes:l.target.value}),placeholder:"Notes",className:"px-1 py-0.5 bg-[#2d2d30] border border-[#3e3e42] rounded text-[#cccccc] text-xs"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>b(a),className:"px-1 py-0.5 bg-[#007acc] text-white text-xs rounded hover:bg-[#005fa3] transition-colors",children:"Save"}),e.jsx("button",{onClick:f,className:"px-1 py-0.5 bg-transparent border border-[#3e3e42] text-[#969696] text-xs rounded hover:text-[#cccccc] hover:bg-[#3e3e42] transition-colors",children:"Cancel"})]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 ml-6",children:[e.jsx("input",{type:"checkbox",id:`completed-${t.id}`,checked:a.isCompleted,onChange:l=>n({...a,isCompleted:l.target.checked}),className:"w-3 h-3"}),e.jsx("label",{htmlFor:`completed-${t.id}`,className:"text-xs text-[#cccccc]",children:"Mark as completed"})]})]}):e.jsxs("div",{className:`flex items-center p-2 rounded text-xs transition-all ${x?"opacity-50 transform scale-95":p?"bg-[#007acc]/20 border border-[#007acc]/50":t.isCompleted?"bg-[#3e3e42]/20 border border-[#3e3e42]/50":"bg-[#3e3e42]/30"}`,draggable:!r,onDragStart:v,onDragOver:m,onDragLeave:g,onDrop:h,onDragEnd:y,children:[e.jsx(D,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 flex-1",children:[e.jsx("div",{className:`${t.isCompleted?"text-[#969696] line-through":"text-[#cccccc]"}`,children:t.percentage!==null?`${t.percentage}%`:"-"}),e.jsx("div",{className:`${t.isCompleted?"text-[#969696] line-through":"text-[#cccccc]"}`,children:t.description||"-"}),e.jsx("div",{className:"text-[#969696]",children:t.date||"-"}),e.jsx("div",{className:"text-[#969696]",children:t.notes||"-"})]}),e.jsxs("div",{className:"flex gap-1 items-center ml-2",children:[t.isCompleted&&e.jsx("span",{className:"text-emerald-400 text-xs mr-1",children:"✓"}),e.jsx("button",{onClick:d,className:"text-[#cccccc] hover:bg-[#3e3e42] px-1 py-0.5 rounded text-xs transition-colors",children:"Edit"}),e.jsx("button",{onClick:j,className:"text-red-400 hover:bg-red-500/20 px-1 py-0.5 rounded text-xs transition-colors",children:"Del"})]})]})},L=({onSave:t,onCancel:u})=>{const[r,x]=i.useState({percentage:null,description:"",date:null,notes:""}),p=()=>{t(r)};return e.jsxs("div",{className:"p-2 bg-[#3e3e42]/50 rounded border border-[#3e3e42] mt-2",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-2 items-center text-xs mb-2",children:[e.jsx("div",{className:"text-[#969696] font-medium w-4"})," ",e.jsx("div",{className:"text-[#969696] font-medium",children:"%"}),e.jsx("div",{className:"text-[#969696] font-medium",children:"DESCRIPTION"}),e.jsx("div",{className:"text-[#969696] font-medium",children:"DATE"}),e.jsx("div",{className:"text-[#969696] font-medium",children:"NOTES"}),e.jsx("div",{className:"text-[#969696] font-medium",children:"ACTIONS"})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-2 items-center",children:[e.jsx("div",{className:"w-4"}),e.jsx("input",{type:"number",min:"0",max:"100",value:r.percentage||"",onChange:d=>x({...r,percentage:d.target.value?Number(d.target.value):null}),placeholder:"% (optional)",className:"px-1 py-0.5 bg-[#2d2d30] border border-[#3e3e42] rounded text-[#cccccc] text-xs [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]"}),e.jsx("input",{type:"text",value:r.description,onChange:d=>x({...r,description:d.target.value}),placeholder:"Description (optional)",className:"px-1 py-0.5 bg-[#2d2d30] border border-[#3e3e42] rounded text-[#cccccc] text-xs"}),e.jsx("input",{type:"date",value:r.date||"",onChange:d=>x({...r,date:d.target.value||null}),className:"px-1 py-0.5 bg-[#2d2d30] border border-[#3e3e42] rounded text-[#cccccc] text-xs"}),e.jsx("input",{type:"text",value:r.notes,onChange:d=>x({...r,notes:d.target.value}),placeholder:"Notes (optional)",className:"px-1 py-0.5 bg-[#2d2d30] border border-[#3e3e42] rounded text-[#cccccc] text-xs"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:p,className:"px-1 py-0.5 bg-[#007acc] text-white text-xs rounded hover:bg-[#005fa3] transition-colors",children:"Add"}),e.jsx("button",{onClick:u,className:"px-1 py-0.5 bg-transparent border border-[#3e3e42] text-[#969696] text-xs rounded hover:text-[#cccccc] hover:bg-[#3e3e42] transition-colors",children:"Cancel"})]})]})]})};export{H as default};
//# sourceMappingURL=DeliverablesSection.BzesmPv2.js.map

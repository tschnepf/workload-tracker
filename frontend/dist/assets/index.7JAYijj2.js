import{j as e}from"./query.D2_a4YYZ.js";import{r as o,a as Pe}from"./react-vendor.BaVwoRKI.js";import{c as R,b as Se,e as De,d as Ae,s as Ie,p as Ee,f as Le,S as we}from"./api.BBwiE9lX.js";import{L as ye,C as te}from"./Card.DBbmFfHk.js";import{B as Q}from"./Button.B1aGBMaa.js";import{U as He}from"./UtilizationBadge.CZolX8GJ.js";import{u as Ce,b as $e}from"./router.BYkwE9TY.js";import{u as Te}from"./useDebounce.lmyEQsFZ.js";const Ke=()=>{const h=Ce(),[p,w]=o.useState([]),[g,D]=o.useState(!0),[y,E]=o.useState(null);o.useEffect(()=>{j()},[]);const j=async()=>{try{D(!0),E(null);const b=await R.list();w(b.results||[])}catch(b){E(b.message||"Failed to load assignments")}finally{D(!1)}},J=async(b,X,S)=>{if(window.confirm(`Remove ${S} from ${X}?`))try{await R.delete(b),await j()}catch(se){E(se.message||"Failed to delete assignment")}};return g?e.jsx(ye,{children:e.jsx(te,{className:"bg-[#2d2d30] border-[#3e3e42] p-6",children:e.jsx("div",{className:"text-slate-300",children:"Loading assignments..."})})}):e.jsx(ye,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-[#cccccc]",children:"Project Assignments"}),e.jsx(Q,{variant:"primary",onClick:()=>h("/assignments/new"),children:"Create Assignment"})]}),y&&e.jsx(te,{className:"bg-red-500/20 border-red-500/50 p-4",children:e.jsx("div",{className:"text-red-400",children:y})}),e.jsx(te,{className:"bg-[#2d2d30] border-[#3e3e42] overflow-hidden",children:p.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"text-[#969696] mb-4",children:"No project assignments yet"}),e.jsx(Q,{variant:"primary",onClick:()=>h("/assignments/new"),children:"Create First Assignment"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-[#3e3e42] border-b border-[#3e3e42]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[#cccccc] uppercase tracking-wider",children:"Person"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[#cccccc] uppercase tracking-wider",children:"Project"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[#cccccc] uppercase tracking-wider",children:"Allocation"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[#cccccc] uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-[#cccccc] uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-600",children:p.map(b=>e.jsxs("tr",{className:"hover:bg-[#3e3e42]/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-[#cccccc]",children:b.personName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-slate-300",children:b.projectDisplayName||b.projectName||"No Project"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(He,{percentage:b.allocationPercentage})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-[#969696] text-sm",children:b.createdAt?new Date(b.createdAt).toLocaleDateString():"-"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm space-x-2",children:[e.jsx(Q,{variant:"secondary",size:"sm",onClick:()=>h(`/assignments/${b.id}/edit`),children:"Edit"}),e.jsx(Q,{variant:"danger",size:"sm",onClick:()=>J(b.id,b.projectDisplayName,b.personName),children:"Remove"})]})]},b.id))})]})})}),e.jsx(te,{className:"bg-[#2d2d30] border-[#3e3e42] p-4",children:e.jsxs("div",{className:"text-[#969696] text-sm",children:["Total: ",e.jsx("span",{className:"text-[#cccccc] font-medium",children:p.length})," active assignments"]})})]})})},Fe=()=>{const h=new Date,p=new Date(h);p.setDate(h.getDate()-h.getDay()%7);const w=[];for(let g=0;g<12;g++){const D=new Date(p);D.setDate(p.getDate()+g*7),w.push(D.toISOString().split("T")[0])}return w},ke=h=>{const p=new Date(h+"T00:00:00"),w=new Date(p);w.setDate(p.getDate()+6);const g={month:"short",day:"numeric"};return`${p.toLocaleDateString("en-US",g)} - ${w.toLocaleDateString("en-US",g)}`},ae=(h,p)=>h.department?p.find(g=>g.id===h.department)?.name||"Unknown Department":"No Department",Qe=()=>{const h=Ce(),{id:p}=$e(),w=!!p,g=(t,s,n)=>{if(n.length===0)return 0;const a=s.filter(d=>d.skillType==="strength").map(d=>d.skillTagName?.toLowerCase()||""),c=n.filter(d=>a.some(l=>l.includes(d.toLowerCase())||d.toLowerCase().includes(l)));return Math.round(c.length/n.length*100)},D=(t,s)=>{if(!t.trim())return[];const n=t.toLowerCase().split(/[,\s]+/).filter(c=>c.length>2),a=[];return s.forEach(c=>{const d=c.name.toLowerCase();n.some(l=>d.includes(l)||l.includes(d))&&a.push(c.name)}),t.split(",").forEach(c=>{const d=c.trim();d.length>2&&!a.some(l=>l.toLowerCase().includes(d.toLowerCase()))&&a.push(d)}),a},y=(t,s,n,a,c)=>{if(!s&&c.length===0)return t;const l=t.find(x=>x.id===Number(s))?.department;return[...t].sort((x,u)=>{const i=a.get(x.id)||[],v=a.get(u.id)||[],A=g(x,i,c),L=g(u,v,c);if(c.length>0&&A!==L)return L-A;if(l){const ve=x.department,Ne=u.department;if(ve===l&&Ne!==l)return-1;if(Ne===l&&ve!==l)return 1}const I=ae(x,n),ee=ae(u,n);return I!==ee?I.localeCompare(ee):x.name.localeCompare(u.name)})},E=(t,s,n)=>{const a=[];if(n.length===0)return a;const c=s.filter(i=>i.skillType==="strength").map(i=>i.skillTagName||""),d=s.filter(i=>i.skillType==="development").map(i=>i.skillTagName||""),l=n.filter(i=>c.some(v=>v.toLowerCase().includes(i.toLowerCase())||i.toLowerCase().includes(v.toLowerCase()))),x=n.filter(i=>d.some(v=>v.toLowerCase().includes(i.toLowerCase())||i.toLowerCase().includes(v.toLowerCase()))),u=n.filter(i=>!l.some(v=>v.toLowerCase().includes(i.toLowerCase())));return l.length===0&&n.length>0&&a.push(`⚠️ No skill matches found for: ${n.join(", ")}`),x.length>0&&a.push(`📈 Development opportunity: ${t.name} is learning ${x.join(", ")}`),u.length>0&&l.length>0&&a.push(`⚠️ Missing skills: ${u.join(", ")}`),a},[j,J]=o.useState([]),[b,X]=o.useState([]),[S,se]=o.useState([]),[C,O]=o.useState(new Map),[z,M]=o.useState([]),[N,re]=o.useState([]),[W]=o.useState(Fe()),[m,F]=o.useState({person:"",project:"",weeklyHours:{}}),[V,ce]=o.useState(""),[U,G]=o.useState(!1),[Y,K]=o.useState(null),[k,H]=o.useState({}),[_,$]=o.useState(0),[P,T]=o.useState(""),[Z,B]=o.useState([]),[f,q]=o.useState(!1),le=Te(P,300);o.useEffect(()=>{ue(),pe(),ie(),oe()},[w,p]),o.useEffect(()=>{const t=D(V,z);re(t)},[V,z,D]),o.useEffect(()=>{if(j.length>0){const t=y(j,m.person,S,C,N);B(t)}},[j,m.person,S,C,N]),o.useEffect(()=>{if(m.person){const t=j.find(s=>s.id===m.person);t&&P!==t.name&&T(t.name)}else T("")},[m.person,j]);const ue=async()=>{try{const s=(await Se.list()).results||[];J(s),B(y(s,m.person,S,C,N))}catch{K("Failed to load people list")}},pe=async()=>{try{const t=await De.listAll();X(t)}catch{K("Failed to load projects list")}},ie=async()=>{try{const t=await Ae.list();se(t.results||[])}catch(t){console.error("Failed to load departments list:",t)}},oe=async()=>{try{const t=await Ie.list();M(t.results||[]);const s=await Ee.list(),n=new Map;(s.results||[]).forEach(a=>{n.has(a.person)||n.set(a.person,[]),n.get(a.person).push(a)}),O(n)}catch(t){console.error("Failed to load skills data:",t)}},he=()=>{const t={};if(m.person||(t.person="Please select a person"),m.project||(t.project="Please select a project"),Object.values(m.weeklyHours).reduce((n,a)=>n+a,0)===0&&(t.weeklyHours="Please allocate at least some hours per week"),m.person){const n=j.find(a=>a.id===m.person);if(n)for(const[a,c]of Object.entries(m.weeklyHours))c>(n.weeklyCapacity||0)&&(t[`week_${a}`]=`Hours for week ${ke(a)} exceed capacity (${n.weeklyCapacity||0}h)`)}return H(t),Object.keys(t).length===0},fe=async t=>{if(t.preventDefault(),!!he())try{G(!0),K(null);const s={person:Number(m.person),project:Number(m.project),weeklyHours:m.weeklyHours};w&&p?await R.update(parseInt(p),s):await R.create(s),h("/assignments")}catch(s){K(s.message||`Failed to ${w?"update":"create"} assignment`)}finally{G(!1)}},ge=(t,s)=>{F(n=>({...n,[t]:s})),k[t]&&H(n=>({...n,[t]:""}))},ne=(t,s)=>{F(a=>({...a,weeklyHours:{...a.weeklyHours,[t]:Math.max(0,s)}}));const n=`week_${t}`;k[n]&&H(a=>({...a,[n]:"",weeklyHours:""}))},je=()=>{if(_>=0){const t={};W.forEach(s=>{t[s]=_}),F(s=>({...s,weeklyHours:t}))}},de=()=>Object.values(m.weeklyHours).reduce((t,s)=>t+s,0),me=()=>m.person&&j.find(s=>s.id===m.person)?.weeklyCapacity||0,xe=t=>{T(t),q(!0),k.person&&H(s=>({...s,person:""}))},be=t=>{const s=y(j,m.person,S,C,N);if(t.trim()==="")B(s);else{const n=s.filter(a=>a.name.toLowerCase().includes(t.toLowerCase()));B(n)}};o.useEffect(()=>{j.length>0&&be(le)},[le,j,S,C,N,m.person]);const r=t=>{F(s=>({...s,person:t.id})),T(t.name),q(!1),B(y(j,t.id,S,C,N))};return e.jsx(ye,{children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-[#cccccc]",children:w?"Edit Assignment":"Create New Assignment"}),e.jsx("p",{className:"text-[#969696] mt-1",children:"Assign a team member to a project with weekly hour allocations for the next 12 weeks"}),m.person&&e.jsxs("div",{className:"mt-2 text-sm text-slate-300",children:["Total hours: ",e.jsxs("span",{className:"font-semibold text-blue-400",children:[de(),"h"]})," • ","Selected person capacity: ",e.jsxs("span",{className:"font-semibold text-green-400",children:[me(),"h/week"]})]})]}),Y&&e.jsx(te,{className:"bg-red-500/20 border-red-500/50 p-4 mb-6",children:e.jsx("div",{className:"text-red-400",children:Y})}),e.jsx(te,{className:"bg-[#2d2d30] border-[#3e3e42] p-6",children:e.jsxs("form",{onSubmit:fe,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-[#cccccc] mb-2",children:["Person ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:P,onChange:t=>xe(t.target.value),onFocus:()=>q(!0),onBlur:()=>{setTimeout(()=>q(!1),200)},placeholder:"Type to search people...",className:"w-full px-3 py-2 rounded-md border text-sm transition-colors bg-[#3e3e42] border-[#3e3e42] text-[#cccccc] placeholder-[#969696] focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none"}),k.person&&e.jsx("p",{className:"text-sm text-red-400 mt-1",children:k.person}),f&&Z.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-[#2d2d30] border border-[#3e3e42] rounded-md shadow-lg max-h-60 overflow-auto",children:Z.map(t=>{const s=m.person&&j.find(x=>x.id===m.person)?.department===t.department,n=ae(t,S),a=C.get(t.id)||[],c=g(t,a,N);let d="";c>=80?d="🎯 ":c>=50?d="⭐ ":s&&(d="🏢 ");const l=c>0?` (${c}% skill match)`:"";return e.jsxs("div",{className:"px-3 py-2 cursor-pointer hover:bg-[#3e3e42] text-[#cccccc] text-sm",onClick:()=>r(t),children:[e.jsxs("div",{className:"font-medium",children:[d,t.name]}),e.jsxs("div",{className:"text-xs text-[#969696]",children:[n," • ",t.weeklyCapacity,"h capacity",l]})]},t.id)})}),m.person&&e.jsx("div",{className:"mt-3 space-y-3",children:(()=>{const t=j.find(l=>l.id===Number(m.person));if(!t)return null;const s=ae(t,S),n=j.filter(l=>l.department===t.department).length-1,a=C.get(t.id)||[],c=g(t,a,N),d=E(t,a,N);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 bg-[#3e3e42]/30 rounded border border-[#3e3e42]",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-[#cccccc] font-medium mb-1",children:"📊 Assignment Insights"}),e.jsxs("div",{className:"text-[#969696]",children:[e.jsxs("div",{children:["Department: ",e.jsx("span",{className:"text-[#cccccc]",children:s})]}),e.jsxs("div",{children:["Capacity: ",e.jsxs("span",{className:"text-[#cccccc]",children:[t.weeklyCapacity||0,"h/week"]})]}),N.length>0&&e.jsxs("div",{className:`mt-1 ${c>=80?"text-emerald-400":c>=50?"text-blue-400":c>0?"text-amber-400":"text-red-400"}`,children:["🎯 Skill match: ",c,"%"]}),n>0&&e.jsxs("div",{className:"mt-1 text-blue-400",children:["💡 ",n," other people available in ",s]})]})]})}),d.length>0&&e.jsx("div",{className:"p-3 bg-amber-500/20 border border-amber-500/30 rounded",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-amber-400 font-medium mb-1",children:"⚠️ Skills Assessment"}),e.jsx("div",{className:"space-y-1",children:d.map((l,x)=>e.jsx("div",{className:"text-amber-300 text-xs",children:l},x))})]})}),a.length>0&&e.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-blue-400 font-medium mb-2",children:["💪 ",t.name,"'s Skills"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.filter(l=>l.skillType==="strength").slice(0,5).map(l=>e.jsx("span",{className:"px-2 py-1 bg-emerald-500/20 text-emerald-400 rounded text-xs",children:l.skillTagName},l.id)),a.filter(l=>l.skillType==="strength").length>5&&e.jsxs("span",{className:"px-2 py-1 bg-slate-500/20 text-slate-400 rounded text-xs",children:["+",a.filter(l=>l.skillType==="strength").length-5," more"]})]})]})})]})})()})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[#cccccc] mb-2",children:["Required Skills ",e.jsx("span",{className:"text-[#969696]",children:"(optional)"})]}),e.jsx("input",{type:"text",value:V,onChange:t=>ce(t.target.value),placeholder:"e.g., React, Python, Project Management, Heat Calculations",className:"w-full px-3 py-2 rounded-md border text-sm transition-colors bg-[#3e3e42] border-[#3e3e42] text-[#cccccc] focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none"}),e.jsx("p",{className:"text-[#969696] text-sm mt-1",children:"Enter skills needed for this assignment (comma-separated). This helps match the best person for the job."}),N.length>0&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[e.jsx("span",{className:"text-xs text-[#969696]",children:"Detected skills:"}),N.map((t,s)=>e.jsx("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs",children:t},s))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[#cccccc] mb-2",children:["Project ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("select",{value:m.project,onChange:t=>ge("project",t.target.value),className:"w-full px-3 py-2 rounded-md border text-sm transition-colors bg-[#3e3e42] border-[#3e3e42] text-[#cccccc] focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Select a project..."}),b.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.client,")"]},t.id))]}),k.project&&e.jsx("p",{className:"text-sm text-red-400 mt-1",children:k.project}),e.jsx("p",{className:"text-[#969696] text-sm mt-1",children:"Select the project for this assignment"}),m.person&&m.project&&e.jsx("div",{className:"mt-3 p-3 bg-blue-500/10 rounded border border-blue-500/30",children:(()=>{const t=j.find(a=>a.id===Number(m.person)),s=b.find(a=>a.id===Number(m.project));if(!t||!s)return null;const n=j.filter(a=>a.department===t.department&&a.id!==t.id);return e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-blue-400 font-medium mb-1",children:"🤝 Collaboration Opportunity"}),e.jsxs("div",{className:"text-[#969696]",children:["Assigning ",e.jsx("span",{className:"text-[#cccccc]",children:t.name})," from"," ",e.jsx("span",{className:"text-[#cccccc]",children:ae(t,S)})," to"," ",e.jsx("span",{className:"text-[#cccccc]",children:s.name}),n.length>0&&e.jsxs("div",{className:"mt-1",children:["Consider also involving: ",n.slice(0,3).map(a=>a.name).join(", "),n.length>3&&` and ${n.length-3} others`]})]})]})})()})]}),e.jsxs("div",{className:"bg-[#3e3e42]/50 p-4 rounded-lg border border-[#3e3e42]",children:[e.jsx("label",{className:"block text-sm font-medium text-[#cccccc] mb-2",children:"Quick Set All Weeks"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"number",min:"0",step:"0.5",value:_,onChange:t=>$(Math.max(0,parseFloat(t.target.value)||0)),className:"px-3 py-1 rounded border text-sm bg-slate-600 border-slate-500 text-[#cccccc] focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none w-20",placeholder:"0"}),e.jsx("span",{className:"text-slate-300 text-sm",children:"hours per week"}),e.jsx(Q,{type:"button",variant:"ghost",onClick:je,className:"text-blue-400 hover:text-blue-300 px-3 py-1",children:"Apply to All"})]}),e.jsx("p",{className:"text-[#969696] text-xs mt-1",children:"Set the same hours for all 12 weeks, then adjust individual weeks as needed"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[#cccccc] mb-3",children:["Weekly Hours Allocation ",e.jsx("span",{className:"text-red-400",children:"*"})]}),k.weeklyHours&&e.jsx("p",{className:"text-sm text-red-400 mb-3",children:k.weeklyHours}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:W.map(t=>{const s=k[`week_${t}`],n=m.weeklyHours[t]||0,a=me(),c=a>0&&n>a;return e.jsxs("div",{className:`p-3 rounded-lg border ${c?"bg-red-500/20 border-red-500/50":"bg-[#3e3e42] border-[#3e3e42]"}`,children:[e.jsx("div",{className:"text-xs text-slate-300 mb-1",children:ke(t)}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",min:"0",step:"0.5",value:n,onChange:d=>ne(t,parseFloat(d.target.value)||0),className:`w-full px-2 py-1 text-sm rounded border ${c?"bg-red-900/50 border-red-500 text-red-300":"bg-slate-600 border-slate-500 text-[#cccccc]"} focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none`,placeholder:"0"}),e.jsx("span",{className:"text-xs text-[#969696]",children:"h"})]}),s&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:s})]},t)})}),e.jsx("p",{className:"text-[#969696] text-sm mt-2",children:"Enter hours per week for each of the next 12 weeks. Red highlighting indicates hours exceed the person's capacity."})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(Q,{type:"button",variant:"ghost",onClick:()=>h("/assignments"),disabled:U,children:"Cancel"}),e.jsx(Q,{type:"submit",variant:"primary",disabled:U,children:U?"Saving...":w?"Update Assignment":"Create Assignment"})]})]})})]})})},Me=({message:h,type:p="info",duration:w=15e3,onDismiss:g})=>{o.useEffect(()=>{const j=setTimeout(()=>{g()},w);return()=>clearTimeout(j)},[w,g]);const y=(()=>{switch(p){case"success":return{border:"border-emerald-400/40",background:"bg-emerald-500/10",text:"text-emerald-300"};case"warning":return{border:"border-orange-400/40",background:"bg-orange-500/10",text:"text-orange-300"};case"error":return{border:"border-red-400/40",background:"bg-red-500/10",text:"text-red-300"};default:return{border:"border-blue-400/40",background:"bg-blue-500/10",text:"text-blue-300"}}})(),E=e.jsx("div",{className:"fixed bottom-6 right-6 z-[9999] animate-in slide-in-from-right-5 duration-500 ease-out",children:e.jsxs("div",{className:`
        relative rounded-xl px-4 py-4 pr-10 min-w-[320px] max-w-[400px]
        bg-[#2d2d30] backdrop-blur-md
        border ${y.border}
        shadow-2xl shadow-black/30
        ${y.background}
        transition-all duration-200 hover:shadow-3xl
      `,children:[e.jsx("div",{className:`text-sm font-medium leading-5 ${y.text}`,children:h}),e.jsx("button",{onClick:g,className:`
            absolute top-3 right-3 w-6 h-6 rounded-full 
            flex items-center justify-center
            ${y.text} opacity-60 hover:opacity-100 
            hover:bg-white/10 transition-all duration-200
            focus:outline-none focus:ring-2 focus:ring-white/20
          `,"aria-label":"Dismiss notification",children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",children:e.jsx("path",{d:"M9 3L3 9M3 3L9 9",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]})});return Pe.createPortal(E,document.body)},We=()=>{const h=new Date,p=new Date(h),w=(h.getDay()+6)%7;p.setDate(h.getDate()-w);const g=[];for(let D=0;D<12;D++){const y=new Date(p);y.setDate(p.getDate()+D*7);const E=new Date(y);E.setDate(y.getDate()+6),g.push({date:y.toISOString().split("T")[0],display:`${y.toLocaleDateString("en-US",{month:"short",day:"numeric"})}`,fullDisplay:`${y.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${E.toLocaleDateString("en-US",{month:"short",day:"numeric"})}`})}return g},Je=()=>{const[h,p]=o.useState([]),[w,g]=o.useState([]),[D,y]=o.useState([]),[E,j]=o.useState(!0),[J,b]=o.useState(null),[X,S]=o.useState(null),[se,C]=o.useState(""),[O,z]=o.useState(null),[M,N]=o.useState([]),[re,W]=o.useState(!1),[m,F]=o.useState(-1),[V,ce]=o.useState(null),[U,G]=o.useState(null),[Y,K]=o.useState(""),[k,H]=o.useState(null),[_,$]=o.useState([]),[P,T]=o.useState(null),[Z,B]=o.useState(!1),f=We(),q=(r,t)=>{const s=new Date(r),n=new Date(t),a=new Date(t);return a.setDate(n.getDate()+6),s>=n&&s<=a},le=(r,t)=>w.filter(s=>s.project===r&&s.date&&q(s.date,t)),ue=r=>{if(!r.trim())return[];const t=r.trim().toLowerCase().split(/\s+/);return D.filter(s=>{const n=[s.name||"",s.client||"",s.projectNumber||""].join(" ").toLowerCase();return t.every(a=>n.includes(a))}).slice(0,8)},pe=r=>{C(r);const t=ue(r);N(t),W(t.length>0),z(null),F(-1)},ie=r=>{z(r),C(r.name),W(!1),N([]),F(-1)},oe=(r,t="info")=>{ce({message:r,type:t})};o.useEffect(()=>{he()},[]),o.useEffect(()=>{const r=t=>{if(!k||U||X!==null)return;const{personId:s,assignmentId:n,week:a}=k,c=h.find(u=>u.id===s),d=c?.assignments.find(u=>u.id===n);if(!c||!d)return;const l=f.findIndex(u=>u.date===a);if(/^[0-9.]$/.test(t.key)){t.preventDefault(),G({personId:s,assignmentId:n,week:a}),K(t.key);return}if(t.key==="Enter"){if(t.preventDefault(),l<f.length-1){const u={personId:s,assignmentId:n,week:f[l+1].date};H(u),T(u),$([])}return}if(t.key==="Tab"){if(t.preventDefault(),l<f.length-1){const u={personId:s,assignmentId:n,week:f[l+1].date};H(u),T(u),$([])}return}let x=null;switch(t.key){case"ArrowLeft":l>0&&(x={personId:s,assignmentId:n,week:f[l-1].date});break;case"ArrowRight":l<f.length-1&&(x={personId:s,assignmentId:n,week:f[l+1].date});break}if(x){if(t.preventDefault(),t.shiftKey&&P){const u=f.findIndex(I=>I.date===P.week),i=f.findIndex(I=>I.date===x.week),[v,A]=[Math.min(u,i),Math.max(u,i)],L=[];for(let I=v;I<=A;I++)L.push({personId:P.personId,assignmentId:P.assignmentId,week:f[I].date});$(L)}else $([]),T(x);H(x)}};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[k,U,h,f,P]),o.useEffect(()=>{const r=()=>{Z&&B(!1)};return window.addEventListener("mouseup",r),()=>window.removeEventListener("mouseup",r)},[Z]);const he=async()=>{try{j(!0),b(null);const[r,t,s,n]=await Promise.all([Se.listAll(),R.listAll(),Le.listAll(),De.listAll()]);g(s),y(n);const a=r.map(c=>({...c,assignments:t.filter(d=>d.person===c.id),isExpanded:!0}));p(a)}catch(r){b("Failed to load assignment data: "+r.message)}finally{j(!1)}},fe=r=>{p(t=>t.map(s=>s.id===r?{...s,isExpanded:!s.isExpanded}:s))},ge=(r,t)=>r.assignments.reduce((s,n)=>s+(n.weeklyHours[t]||0),0),ne=async(r,t)=>{try{const s=await R.create({person:r,project:t.id,weeklyHours:{}});p(a=>a.map(c=>c.id===r?{...c,assignments:[...c.assignments,s]}:c));const n=h.find(a=>a.id===r);if(n){const a=n.assignments.length+1;a>=3?oe(`⚠️ ${n.name} is now assigned to ${a} projects. Monitor workload to avoid overallocation.`,"warning"):oe(`✓ ${n.name} successfully assigned to ${t.name}`,"success")}S(null),C(""),z(null),N([]),W(!1)}catch(s){console.error("Failed to create assignment:",s),alert("Failed to create assignment: "+s.message)}},je=async(r,t)=>{if(confirm("Are you sure you want to remove this assignment?"))try{await R.delete(r),p(s=>s.map(n=>n.id===t?{...n,assignments:n.assignments.filter(a=>a.id!==r)}:n))}catch(s){console.error("Failed to delete assignment:",s),alert("Failed to delete assignment: "+s.message)}},de=async(r,t,s,n)=>{try{const c=h.find(l=>l.id===r)?.assignments.find(l=>l.id===t);if(!c)return;const d={...c.weeklyHours,[s]:n};await R.update(t,{weeklyHours:d}),p(l=>l.map(x=>x.id===r?{...x,assignments:x.assignments.map(u=>u.id===t?{...u,weeklyHours:d}:u)}:x))}catch(a){console.error("Failed to update assignment hours:",a),alert("Failed to update hours: "+a.message)}},me=(r,t,s)=>_.some(n=>n.personId===r&&n.assignmentId===t&&n.week===s),xe=async(r,t)=>{try{const s=new Map;r.forEach(c=>{const d=`${c.personId}-${c.assignmentId}`;if(!s.has(d)){const u=h.find(i=>i.id===c.personId)?.assignments.find(i=>i.id===c.assignmentId);u&&s.set(d,{personId:c.personId,assignmentId:c.assignmentId,weeklyHours:{...u.weeklyHours}})}const l=s.get(d);l&&(l.weeklyHours[c.week]=t)});const n=Array.from(s.values()).map(async c=>(await R.update(c.assignmentId,{weeklyHours:c.weeklyHours}),c)),a=await Promise.all(n);p(c=>c.map(d=>{const l=a.filter(x=>x.personId===d.id);return l.length===0?d:{...d,assignments:d.assignments.map(x=>{const u=l.find(i=>i.assignmentId===x.id);return u?{...x,weeklyHours:u.weeklyHours}:x})}}))}catch(s){console.error("Failed to update multiple cells:",s),alert("Failed to update multiple cells: "+s.message)}},be=(r,t)=>{if(r===0)return"bg-[#3e3e42] text-[#969696]";const s=r/t*100;return s<=70?"bg-emerald-500/20 text-emerald-300 border border-emerald-500/30":s<=85?"bg-blue-500/20 text-blue-300 border border-blue-500/30":s<=100?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"bg-red-500/20 text-red-300 border border-red-500/30"};return E?e.jsxs("div",{className:"min-h-screen bg-[#1e1e1e] flex",children:[e.jsx(we,{}),e.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-[#969696]",children:"Loading assignments..."})})})]}):J?e.jsxs("div",{className:"min-h-screen bg-[#1e1e1e] flex",children:[e.jsx(we,{}),e.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-red-400",children:J})})})]}):e.jsxs("div",{className:"min-h-screen bg-[#1e1e1e] flex",children:[e.jsx(we,{}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx("div",{className:"sticky top-0 bg-[#1e1e1e] border-b border-[#3e3e42] z-30 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-[#cccccc]",children:"Assignment Grid"}),e.jsx("p",{className:"text-[#969696] text-sm",children:"Manage team workload allocation across 12 weeks"})]}),e.jsxs("div",{className:"text-xs text-[#969696]",children:[h.length," people • ",h.reduce((r,t)=>r+t.assignments.length,0)," assignments"]})]})}),e.jsx("div",{className:"sticky top-[88px] bg-[#2d2d30] border-b border-[#3e3e42] z-20 overflow-x-auto",children:e.jsx("div",{className:"min-w-[1400px]",children:e.jsxs("div",{className:"grid grid-cols-[280px_40px_repeat(12,70px)] gap-px p-2",children:[e.jsx("div",{className:"font-medium text-[#cccccc] text-sm px-2 py-1",children:"Team Member"}),e.jsx("div",{className:"text-center text-xs text-[#969696] px-1",children:"+/-"}),f.map((r,t)=>e.jsxs("div",{className:"text-center px-1",children:[e.jsx("div",{className:"text-xs font-medium text-[#cccccc]",children:r.display}),e.jsxs("div",{className:"text-[10px] text-[#757575]",children:["W",t+1]})]},r.date))]})})}),e.jsx("div",{className:"flex-1 overflow-x-auto bg-[#1e1e1e]",children:e.jsx("div",{className:"min-w-[1400px]",children:e.jsx("div",{children:h.map(r=>e.jsxs("div",{className:"border-b border-[#3e3e42] last:border-b-0",children:[e.jsxs("div",{className:"grid grid-cols-[280px_40px_repeat(12,70px)] gap-px p-2 hover:bg-[#2d2d30]/50 transition-colors",children:[e.jsxs("button",{onClick:()=>fe(r.id),className:"flex items-center gap-2 pl-3 pr-2 py-1 w-full text-left hover:bg-[#3e3e42]/50 transition-all duration-200 rounded-sm",children:[e.jsx("div",{className:"flex-shrink-0 w-5 h-5 flex items-center justify-center text-[#969696]",children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",className:`transition-transform duration-200 ${r.isExpanded?"rotate-90":"rotate-0"}`,children:e.jsx("path",{d:"M4 2 L8 6 L4 10",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-[#cccccc] text-sm truncate",children:r.name}),e.jsxs("div",{className:"text-xs text-[#969696]",children:[r.role," • ",r.weeklyCapacity,"h/wk"]})]})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("button",{className:"w-7 h-7 rounded text-white hover:text-[#969696] hover:bg-[#3e3e42] transition-colors text-center text-sm font-medium leading-none font-mono",style:{display:"flex",alignItems:"center",justifyContent:"center"},title:"Add new assignment",onClick:()=>{S(r.id),C("")},children:"+"})}),f.map(t=>{const s=ge(r,t.date);return e.jsx("div",{className:"flex items-center justify-center px-1",children:e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium min-w-[40px] text-center ${be(s,r.weeklyCapacity)}`,children:s>0?`${s}h`:"—"})},t.date)})]}),r.isExpanded&&r.assignments.map(t=>e.jsxs("div",{className:"grid grid-cols-[280px_40px_repeat(12,70px)] gap-px p-1 bg-[#252526] hover:bg-[#2d2d30] transition-colors",children:[e.jsx("div",{className:"flex items-center py-1 pl-[60px] pr-2",children:e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("div",{className:"text-[#cccccc] text-xs truncate",children:t.projectDisplayName})})}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("button",{className:"w-7 h-7 rounded text-red-500 hover:text-red-400 hover:bg-red-500/10 transition-colors text-center text-sm font-medium leading-none font-mono",style:{display:"flex",alignItems:"center",justifyContent:"center"},title:"Remove assignment",onClick:()=>je(t.id,r.id),children:"×"})}),f.map(s=>{const n=t.weeklyHours?.[s.date]||0,a={personId:r.id,assignmentId:t.id,week:s.date},c=U?.personId===r.id&&U?.assignmentId===t.id&&U?.week===s.date,d=k?.personId===r.id&&k?.assignmentId===t.id&&k?.week===s.date,l=me(r.id,t.id,s.date),x=t.project?le(t.project,s.date):[],u=x.length>0;return e.jsx("div",{className:"flex items-center justify-center px-1",children:c?e.jsx("input",{type:"number",min:"0",step:"0.5",value:Y,onChange:i=>K(i.target.value),className:"w-12 h-6 text-xs rounded border bg-[#3e3e42] border-[#3e3e42] text-[#cccccc] text-center focus:border-[#007acc] focus:ring-1 focus:ring-[#007acc] focus:outline-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onBlur:()=>{const i=parseFloat(Y)||0;_.length>0?(xe(_,i),$([])):de(r.id,t.id,s.date,i),G(null)},onKeyDown:i=>{if(i.key==="Enter"||i.key==="Tab"){i.preventDefault(),i.stopPropagation();const v=parseFloat(Y)||0;_.length>0?(xe(_,v),$([])):de(r.id,t.id,s.date,v),G(null);const A=f.findIndex(L=>L.date===s.date);if(A<f.length-1){const L={personId:r.id,assignmentId:t.id,week:f[A+1].date};H(L),T(L)}}else i.key==="Escape"&&G(null)},autoFocus:!0}):e.jsx("div",{className:`w-12 h-6 text-xs rounded flex items-center justify-center cursor-pointer transition-colors ${l?"ring-2 ring-purple-400 bg-purple-500/30 text-[#cccccc]":d?"ring-2 ring-blue-400 bg-blue-500/20 text-[#cccccc]":u?"text-[#cccccc] hover:bg-[#3e3e42] ring-1 ring-orange-400/80 bg-orange-500/15":"text-[#cccccc] hover:bg-[#3e3e42]"}`,title:u?x.map(i=>{const v=[];return i.percentage!==null&&i.percentage!==void 0&&v.push(`${i.percentage}%`),i.description&&v.push(i.description),v.join(" ")}).join(", "):void 0,onClick:i=>{i.preventDefault(),H(a),T(a),$([])},onMouseDown:i=>{i.preventDefault(),H(a),T(a),B(!0),$([])},onMouseEnter:()=>{if(Z&&P){const i=f.findIndex(A=>A.date===P.week),v=f.findIndex(A=>A.date===s.date);if(P.personId===r.id&&P.assignmentId===t.id){const[A,L]=[Math.min(i,v),Math.max(i,v)],I=[];for(let ee=A;ee<=L;ee++)I.push({personId:r.id,assignmentId:t.id,week:f[ee].date});$(I)}}},onMouseUp:()=>{B(!1)},children:n>0?n:"—"})},s.date)})]},t.id)),r.isExpanded&&X===r.id&&e.jsxs("div",{className:"grid grid-cols-[280px_40px_repeat(12,70px)] gap-px p-1 bg-[#2d2d30] border border-blue-500/30",children:[e.jsxs("div",{className:"flex items-center py-1 pl-[60px] pr-2 relative",children:[e.jsx("input",{type:"text",value:se,onChange:t=>pe(t.target.value),onKeyDown:t=>{if(t.key==="Enter")if(t.preventDefault(),m>=0&&m<M.length){const s=M[m];ie(s),ne(r.id,s)}else O&&ne(r.id,O);else t.key==="Escape"?(S(null),C(""),z(null),W(!1),F(-1)):t.key==="ArrowDown"?(t.preventDefault(),M.length>0&&(W(!0),F(s=>s<M.length-1?s+1:s))):t.key==="ArrowUp"&&(t.preventDefault(),re&&M.length>0&&F(s=>s>-1?s-1:-1))},placeholder:"Search projects (name, client, number)...",className:"w-full px-2 py-1 text-xs bg-[#3e3e42] border border-[#3e3e42] rounded text-[#cccccc] placeholder-[#969696] focus:border-[#007acc] focus:outline-none",autoFocus:!0}),re&&M.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-[#2d2d30] border border-[#3e3e42] rounded shadow-lg z-50 max-h-48 overflow-y-auto",children:M.map((t,s)=>e.jsxs("button",{onClick:()=>ie(t),className:`w-full text-left px-2 py-1 text-xs transition-colors text-[#cccccc] border-b border-[#3e3e42] last:border-b-0 ${m===s?"bg-[#007acc]/30 border-[#007acc]":"hover:bg-[#3e3e42]"}`,children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-[#969696]",children:[t.client,t.projectNumber].filter(Boolean).join(" • ")})]},t.id))})]}),e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{className:"w-5 h-5 rounded bg-green-600 hover:bg-green-500 text-white text-xs font-medium transition-colors flex items-center justify-center",title:"Save assignment",onClick:()=>O&&ne(r.id,O),disabled:!O,children:"✓"}),e.jsx("button",{className:"w-5 h-5 rounded bg-[#3e3e42] hover:bg-[#4e4e52] text-white text-xs font-medium transition-colors flex items-center justify-center",title:"Cancel",onClick:()=>{S(null),C(""),z(null),N([]),W(!1)},children:"✕"})]}),f.map(t=>e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-6 flex items-center justify-center text-[#757575] text-xs",children:"—"})},t.date))]}),r.isExpanded&&r.assignments.length===0&&e.jsxs("div",{className:"grid grid-cols-[280px_40px_repeat(12,70px)] gap-px p-1 bg-[#252526]",children:[e.jsx("div",{className:"flex items-center py-1 pl-[60px] pr-2",children:e.jsx("div",{className:"text-[#757575] text-xs italic",children:"No assignments"})}),e.jsx("div",{}),f.map(t=>e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-6 flex items-center justify-center text-[#757575] text-xs",children:"—"})},t.date))]})]},r.id))})})}),e.jsx("div",{className:"flex justify-between items-center text-xs text-[#969696] px-1",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{children:"Available (≤70%)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("span",{children:"Busy (71-85%)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500"}),e.jsx("span",{children:"Full (86-100%)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("span",{children:"Overallocated (>100%)"})]})]})})]}),V&&e.jsx(Me,{message:V.message,type:V.type,onDismiss:()=>ce(null)})]})};export{Qe as AssignmentForm,Je as AssignmentGrid,Ke as AssignmentList};
//# sourceMappingURL=index.7JAYijj2.js.map

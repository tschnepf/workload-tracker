import{j as e}from"./query.D2_a4YYZ.js";import{r as c}from"./react-vendor.BaVwoRKI.js";import{d as T,b as F,S as B,a as G,p as K}from"./api.BBwiE9lX.js";import{B as _}from"./Button.B1aGBMaa.js";import{C as p,L}from"./Card.DBbmFfHk.js";import{I as q}from"./Input.CAfEA-5q.js";import{U as V}from"./UtilizationBadge.CZolX8GJ.js";import"./router.BYkwE9TY.js";const X=({department:x,departments:w,people:d,onSave:k,onCancel:s})=>{const D=!!x,[g,y]=c.useState({name:"",parentDepartment:null,manager:null,description:"",isActive:!0}),[h,a]=c.useState(!1),[v,o]=c.useState(null),[i,n]=c.useState({});c.useEffect(()=>{y(x?{name:x.name,parentDepartment:x.parentDepartment,manager:x.manager,description:x.description||"",isActive:x.isActive!==!1}:{name:"",parentDepartment:null,manager:null,description:"",isActive:!0})},[x]);const u=()=>{const t={};if(g.name.trim()||(t.name="Department name is required"),g.parentDepartment===x?.id)t.parentDepartment="Department cannot be its own parent";else if(g.parentDepartment&&x?.id){const l=(m,b=new Set)=>{if(b.has(m)||b.size>10)return!0;const P=w.find(U=>U.id===m);return!P||!P.parentDepartment?!1:(b.add(m),l(P.parentDepartment,b))};l(g.parentDepartment)&&(t.parentDepartment="This parent selection would create a circular hierarchy")}return n(t),Object.keys(t).length===0},A=async t=>{if(t.preventDefault(),!!u()){a(!0),o(null);try{const l={name:g.name.trim(),parentDepartment:g.parentDepartment,manager:g.manager,description:g.description.trim(),isActive:g.isActive};await k(l)}catch(l){o(l.message||"Failed to save department")}finally{a(!1)}}},f=(t,l)=>{y(m=>({...m,[t]:l})),i[t]&&n(m=>({...m,[t]:""}))},S=w.filter(t=>t.id!==x?.id);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsx(p,{className:"w-full max-w-lg bg-[#2d2d30] border-[#3e3e42] max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-[#cccccc]",children:D?"Edit Department":"Add Department"}),e.jsx("button",{onClick:s,className:"text-[#969696] hover:text-[#cccccc] text-xl",children:"Ã—"})]}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[v&&e.jsx("div",{className:"p-3 bg-red-900/30 border border-red-600 rounded text-red-400",children:v}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#cccccc] mb-1",children:"Department Name *"}),e.jsx(q,{value:g.name,onChange:t=>f("name",t.target.value),placeholder:"e.g. Engineering",className:`w-full ${i.name?"border-red-600":""}`,disabled:h}),i.name&&e.jsx("p",{className:"mt-1 text-sm text-red-400",children:i.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#cccccc] mb-1",children:"Parent Department"}),e.jsxs("select",{value:g.parentDepartment||"",onChange:t=>f("parentDepartment",t.target.value?parseInt(t.target.value):null),className:`w-full px-3 py-2 bg-[#3e3e42] border border-[#3e3e42] rounded-md text-[#cccccc] focus:outline-none focus:ring-2 focus:ring-[#007acc] focus:border-transparent ${i.parentDepartment?"border-red-600":""}`,disabled:h,children:[e.jsx("option",{value:"",children:"None (Top Level)"}),S.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),i.parentDepartment&&e.jsx("p",{className:"mt-1 text-sm text-red-400",children:i.parentDepartment})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#cccccc] mb-1",children:"Manager"}),e.jsxs("select",{value:g.manager||"",onChange:t=>f("manager",t.target.value?parseInt(t.target.value):null),className:"w-full px-3 py-2 bg-[#3e3e42] border border-[#3e3e42] rounded-md text-[#cccccc] focus:outline-none focus:ring-2 focus:ring-[#007acc] focus:border-transparent",disabled:h,children:[e.jsx("option",{value:"",children:"None Assigned"}),d.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#cccccc] mb-1",children:"Description"}),e.jsx("textarea",{value:g.description,onChange:t=>f("description",t.target.value),placeholder:"Brief description of the department's purpose...",rows:3,className:"w-full px-3 py-2 bg-[#3e3e42] border border-[#3e3e42] rounded-md text-[#cccccc] focus:outline-none focus:ring-2 focus:ring-[#007acc] focus:border-transparent resize-none",disabled:h})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:g.isActive,onChange:t=>f("isActive",t.target.checked),className:"mr-2 w-4 h-4 text-[#007acc] bg-[#3e3e42] border-[#3e3e42] rounded focus:ring-[#007acc] focus:ring-2",disabled:h}),e.jsx("label",{htmlFor:"isActive",className:"text-sm text-[#cccccc]",children:"Department is active"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(_,{type:"button",variant:"secondary",onClick:s,disabled:h,children:"Cancel"}),e.jsx(_,{type:"submit",variant:"primary",disabled:h,children:h?"Saving...":D?"Update":"Create"})]})]})]})})})},de=()=>{const[x,w]=c.useState([]),[d,k]=c.useState([]),[s,D]=c.useState(null),[g,y]=c.useState(-1),[h,a]=c.useState(""),[v,o]=c.useState(!1),[i,n]=c.useState(null),[u,A]=c.useState(!0),[f,S]=c.useState(null),[t,l]=c.useState(!1);c.useEffect(()=>{b(),P()},[]);const m=c.useMemo(()=>x.filter(N=>N.name.toLowerCase().includes(h.toLowerCase())||N.description&&N.description.toLowerCase().includes(h.toLowerCase())).sort((N,C)=>N.name.localeCompare(C.name)),[x,h]);c.useEffect(()=>{m.length>0&&!s&&!t&&(D(m[0]),y(0),l(!0))},[m,t]);const b=async()=>{try{A(!0);const r=await T.list();w(r.results||[])}catch(r){S("Failed to load departments"),console.error("Error loading departments:",r)}finally{A(!1)}},P=async()=>{try{const r=await F.list();k(r.results||[])}catch(r){console.error("Error loading people:",r)}},U=()=>{n(null),o(!0)},R=r=>{n(r),o(!0)},M=async r=>{try{let N;i?.id?N=await T.update(i.id,r):N=await T.create(r),await b(),D(N),o(!1),n(null)}catch(N){console.error("Failed to save department:",N),S(`Failed to save department: ${N.message}`)}},$=async r=>{if(!(!r.id||!window.confirm(`Are you sure you want to delete "${r.name}"?`)))try{await T.delete(r.id),await b(),s?.id===r.id&&(D(null),y(-1))}catch(C){S(`Failed to delete department: ${C.message}`),console.error("Error deleting department:",C)}},z=r=>{if(!r)return"None";const N=x.find(C=>C.id===r);return N?N.name:"Unknown"};return u?e.jsxs("div",{className:"flex h-screen bg-[#1e1e1e]",children:[e.jsx(B,{}),e.jsx("div",{className:"flex-1 p-8 text-[#cccccc]",children:"Loading departments..."})]}):e.jsxs("div",{className:"flex h-screen bg-[#1e1e1e]",children:[e.jsx(B,{}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-1/3 p-6 border-r border-[#3e3e42] bg-[#252526]",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-[#cccccc]",children:"Departments"}),e.jsx(_,{variant:"primary",onClick:U,children:"Add Department"})]}),e.jsx(q,{placeholder:"Search departments...",value:h,onChange:r=>a(r.target.value),className:"w-full"})]}),f&&e.jsx("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-600 rounded text-red-400",children:f}),e.jsxs("div",{className:"space-y-3",children:[m.map((r,N)=>e.jsx(p,{className:`p-4 cursor-pointer transition-colors bg-[#2d2d30] border-[#3e3e42] hover:bg-[#3e3e42]/50 ${s?.id===r.id?"ring-2 ring-[#007acc]":""}`,onClick:()=>{D(r),y(N)},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-[#cccccc] mb-1",children:r.name}),e.jsxs("p",{className:"text-sm text-[#969696] mb-2",children:["Manager: ",r.managerName||"None"]}),r.description&&e.jsx("p",{className:"text-sm text-[#969696] line-clamp-2",children:r.description}),r.parentDepartment&&e.jsxs("p",{className:"text-xs text-[#969696] mt-1",children:["Parent: ",z(r.parentDepartment)]})]}),e.jsx("div",{className:"ml-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${r.isActive?"bg-emerald-500/20 text-emerald-400":"bg-gray-500/20 text-gray-400"}`,children:r.isActive?"Active":"Inactive"})})]})},r.id)),m.length===0&&e.jsx("div",{className:"text-center py-8 text-[#969696]",children:h?"No departments match your search.":"No departments found."})]})]}),e.jsx("div",{className:"flex-1 p-6 bg-[#1e1e1e]",children:s?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-[#cccccc] mb-2",children:s.name}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("span",{className:`px-3 py-1 rounded text-sm ${s.isActive?"bg-emerald-500/20 text-emerald-400":"bg-gray-500/20 text-gray-400"}`,children:s.isActive?"Active":"Inactive"})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(_,{variant:"secondary",onClick:()=>R(s),children:"Edit"}),e.jsx(_,{variant:"danger",onClick:()=>$(s),children:"Delete"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs(p,{className:"p-6 bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("h3",{className:"font-semibold text-[#cccccc] mb-4",children:"Department Info"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-[#969696]",children:"Name:"}),e.jsx("p",{className:"text-[#cccccc]",children:s.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-[#969696]",children:"Manager:"}),e.jsx("p",{className:"text-[#cccccc]",children:s.managerName||"None assigned"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-[#969696]",children:"Parent Department:"}),e.jsx("p",{className:"text-[#cccccc]",children:z(s.parentDepartment)})]}),s.description&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-[#969696]",children:"Description:"}),e.jsx("p",{className:"text-[#cccccc] mt-1",children:s.description})]})]})]}),e.jsxs(p,{className:"p-6 bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("h3",{className:"font-semibold text-[#cccccc] mb-4",children:"System Info"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-[#969696]",children:"Created:"}),e.jsx("p",{className:"text-[#cccccc]",children:s.createdAt?new Date(s.createdAt).toLocaleDateString():"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-[#969696]",children:"Updated:"}),e.jsx("p",{className:"text-[#cccccc]",children:s.updatedAt?new Date(s.updatedAt).toLocaleDateString():"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-[#969696]",children:"Status:"}),e.jsx("p",{className:s.isActive?"text-emerald-400":"text-gray-400",children:s.isActive?"Active":"Inactive"})]})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-[#969696]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl mb-2",children:"Select a Department"}),e.jsx("p",{children:"Choose a department from the list to view details"})]})})})]})}),v&&e.jsx(X,{department:i,departments:x,people:d,onSave:M,onCancel:()=>{o(!1),n(null),S(null)}})]})},me=()=>{const[x,w]=c.useState([]),[d,k]=c.useState(""),[s,D]=c.useState(null),[g,y]=c.useState([]),[h,a]=c.useState(!0),[v,o]=c.useState(null),[i,n]=c.useState(1);c.useEffect(()=>{u()},[]),c.useEffect(()=>{d&&(A(),f())},[d,i]);const u=async()=>{try{const l=(await T.list()).results||[];w(l),l.length>0&&!d&&k(l[0].id.toString())}catch(t){console.error("Error loading departments:",t),o("Failed to load departments")}},A=async()=>{try{a(!0),o(null);const t=await G.getDashboard(i,d);D(t)}catch(t){o(t.message||"Failed to load department data")}finally{a(!1)}},f=async()=>{try{const m=((await F.list()).results||[]).filter(b=>b.department?.toString()===d);y(m)}catch(t){console.error("Error loading department people:",t)}},S=x.find(t=>t.id?.toString()===d);return h&&!s?e.jsx(L,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-[#969696]",children:"Loading manager dashboard..."})})}):e.jsx(L,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#cccccc]",children:"Manager Dashboard"}),e.jsxs("p",{className:"text-[#969696] mt-2",children:["Department-focused management and team insights",S&&e.jsxs("span",{className:"block mt-1 text-[#cccccc]",children:["Managing: ",S.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm text-[#969696]",children:"Department:"}),e.jsxs("select",{value:d,onChange:t=>k(t.target.value),className:"px-3 py-1.5 text-sm bg-[#3e3e42] border border-[#3e3e42] rounded text-[#cccccc] focus:border-[#007acc] focus:outline-none min-w-[140px]",children:[e.jsx("option",{value:"",children:"Select Department..."}),x.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.managerName&&`(${t.managerName})`]},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm text-[#969696]",children:"Period:"}),e.jsx("div",{className:"flex gap-1",children:[1,2,4,8].map(t=>e.jsxs("button",{onClick:()=>n(t),className:`px-2 py-1 text-xs rounded transition-colors ${i===t?"bg-[#007acc] text-white":"bg-[#3e3e42] text-[#969696] hover:text-[#cccccc] hover:bg-[#4e4e52]"}`,children:[t,"w"]},t))})]})]})]}),v&&e.jsx(p,{className:"bg-red-500/20 border-red-500/50 p-4",children:e.jsx("div",{className:"text-red-400",children:v})}),d?s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Team Members"}),e.jsx("div",{className:"text-2xl font-bold text-[#cccccc]",children:s.summary.total_people}),e.jsxs("div",{className:"text-xs text-[#969696] mt-1",children:["In ",S?.name]})]}),e.jsxs(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Department Utilization"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-400",children:[s.summary.avg_utilization,"%"]}),e.jsx("div",{className:"text-xs text-[#969696] mt-1",children:i===1?"Current week":`${i}-week average`})]}),e.jsxs(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Active Assignments"}),e.jsx("div",{className:"text-2xl font-bold text-[#cccccc]",children:s.summary.total_assignments}),e.jsx("div",{className:"text-xs text-[#969696] mt-1",children:"Department projects"})]}),e.jsxs(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Needs Attention"}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:s.summary.overallocated_count}),e.jsx("div",{className:"text-xs text-[#969696] mt-1",children:"Overallocated people"})]})]}),e.jsxs(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#cccccc] mb-4",children:"Team Management Overview"}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[s.team_overview.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#3e3e42]/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-[#cccccc]",children:t.name}),e.jsxs("div",{className:"text-sm text-[#969696]",children:[t.role," â€¢ ",t.allocated_hours,"h / ",t.capacity,"h"]}),i>1&&t.peak_utilization_percent!==t.utilization_percent&&e.jsxs("div",{className:"text-xs text-amber-400 mt-1",children:["Peak: ",t.peak_utilization_percent,"%",t.is_peak_overallocated&&" âš ï¸"]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(V,{percentage:t.utilization_percent}),t.is_overallocated&&e.jsx("div",{className:"text-xs text-red-400",children:"Action needed"})]})]},t.id)),s.team_overview.length===0&&e.jsx("div",{className:"text-center py-8 text-[#969696]",children:"No team members found in this department"})]})]}),e.jsxs(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#cccccc] mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{className:"p-4 bg-[#3e3e42]/50 rounded-lg border border-[#3e3e42] hover:bg-[#3e3e42]/70 transition-colors text-left",children:[e.jsx("div",{className:"text-[#cccccc] font-medium mb-1",children:"ðŸ‘¥ Manage Team"}),e.jsx("div",{className:"text-sm text-[#969696]",children:"Add, edit, or reassign team members"})]}),e.jsxs("button",{className:"p-4 bg-[#3e3e42]/50 rounded-lg border border-[#3e3e42] hover:bg-[#3e3e42]/70 transition-colors text-left",children:[e.jsx("div",{className:"text-[#cccccc] font-medium mb-1",children:"ðŸ“Š View Reports"}),e.jsx("div",{className:"text-sm text-[#969696]",children:"Department performance analytics"})]}),e.jsxs("button",{className:"p-4 bg-[#3e3e42]/50 rounded-lg border border-[#3e3e42] hover:bg-[#3e3e42]/70 transition-colors text-left",children:[e.jsx("div",{className:"text-[#cccccc] font-medium mb-1",children:"âš–ï¸ Balance Workload"}),e.jsx("div",{className:"text-sm text-[#969696]",children:"Redistribute assignments"})]})]})]})]}):null:e.jsx(p,{className:"bg-[#2d2d30] border-[#3e3e42] p-8 text-center",children:e.jsxs("div",{className:"text-[#969696]",children:[e.jsx("h3",{className:"text-lg mb-2",children:"Select a Department"}),e.jsx("p",{children:"Choose a department to view management insights and team metrics"})]})})]})})},Y=({departments:x,people:w,onDepartmentClick:d,selectedDepartmentId:k})=>{const[s,D]=c.useState([]);c.useEffect(()=>{x.length>0&&g()},[x,w]);const g=()=>{const a={};x.forEach(i=>{const n=w.filter(u=>u.department===i.id);a[i.id]={...i,children:[],people:n,level:0}});const v=[];x.forEach(i=>{i.parentDepartment&&a[i.parentDepartment]?a[i.parentDepartment].children.push(a[i.id]):v.push(a[i.id])});const o=(i,n=0)=>{i.forEach(u=>{u.level=n,o(u.children,n+1)})};o(v),D(v)},y=({node:a})=>{const v=k===a.id,o=a.children.length>0;return e.jsxs("div",{className:"relative",children:[e.jsxs(p,{className:`p-4 cursor-pointer transition-all bg-[#2d2d30] border-[#3e3e42] hover:bg-[#3e3e42]/50 ${v?"ring-2 ring-[#007acc] bg-[#007acc]/10":""}`,onClick:()=>d?.(a),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-[#cccccc] mb-1 truncate",children:a.name}),e.jsxs("div",{className:"text-xs text-[#969696] mb-2",children:["Manager: ",a.managerName||"None assigned"]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("div",{className:"text-blue-400",children:["ðŸ‘¥ ",a.people.length," people"]}),o&&e.jsxs("div",{className:"text-emerald-400",children:["ðŸ¢ ",a.children.length," sub-dept",a.children.length!==1?"s":""]})]}),a.description&&e.jsx("div",{className:"text-xs text-[#969696] mt-2 line-clamp-2",children:a.description})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs ${a.isActive?"bg-emerald-500/20 text-emerald-400":"bg-gray-500/20 text-gray-400"}`,children:a.isActive?"Active":"Inactive"})]}),a.people.length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-[#3e3e42]/50",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.people.slice(0,3).map((i,n)=>e.jsx("span",{className:"px-2 py-1 bg-[#3e3e42]/50 text-xs text-[#cccccc] rounded",children:i.name},i.id)),a.people.length>3&&e.jsxs("span",{className:"px-2 py-1 bg-[#3e3e42]/30 text-xs text-[#969696] rounded",children:["+",a.people.length-3," more"]})]})})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute left-1/2 bottom-0 w-px h-6 bg-[#3e3e42] transform -translate-x-0.5"}),a.children.length>1&&e.jsx("div",{className:"absolute top-full left-1/2 mt-6 h-px bg-[#3e3e42] transform -translate-y-0.5",style:{width:`${(a.children.length-1)*280+200}px`,left:`calc(50% - ${((a.children.length-1)*280+200)/2}px)`}})]})]})},h=(a,v=0)=>a.length===0?null:e.jsx("div",{className:"space-y-8",children:e.jsx("div",{className:`flex ${a.length===1?"justify-center":"justify-center space-x-8"} flex-wrap gap-8`,children:a.map(o=>e.jsxs("div",{className:"flex flex-col items-center relative",children:[v>0&&e.jsx("div",{className:"w-px h-6 bg-[#3e3e42] mb-2"}),e.jsx("div",{className:"w-64",children:e.jsx(y,{node:o})}),o.children.length>0&&e.jsx("div",{className:"mt-8",children:h(o.children,v+1)})]},o.id))})});return s.length===0?e.jsxs("div",{className:"text-center py-8 text-[#969696]",children:[e.jsx("h3",{className:"text-lg mb-2",children:"No Department Hierarchy"}),e.jsx("p",{className:"text-sm",children:"Create departments to see the organizational structure"})]}):e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-6 p-4 bg-[#2d2d30] border border-[#3e3e42] rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-[#cccccc] mb-2",children:"Legend"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-[#969696]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded"}),e.jsx("span",{children:"Team members"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-400 rounded"}),e.jsx("span",{children:"Sub-departments"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-[#007acc] rounded"}),e.jsx("span",{children:"Selected department"})]})]})]}),e.jsx("div",{className:"overflow-x-auto pb-6",children:e.jsx("div",{className:"min-w-max px-4",children:h(s)})})]})},xe=()=>{const[x,w]=c.useState([]),[d,k]=c.useState([]),[s,D]=c.useState(null),[g,y]=c.useState(!0),[h,a]=c.useState(null);c.useEffect(()=>{v()},[]);const v=async()=>{try{y(!0),a(null);const[n,u]=await Promise.all([T.list(),F.list()]);w(n.results||[]),k(u.results||[])}catch(n){a(n.message||"Failed to load data")}finally{y(!1)}},o=n=>{D(n)},i=n=>{const u=d.filter(f=>f.department===n.id),A=x.filter(f=>f.parentDepartment===n.id);return{directReports:u.length,subDepartments:A.length,totalTeamSize:u.length+A.reduce((f,S)=>f+d.filter(t=>t.department===S.id).length,0)}};return g?e.jsx(L,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-[#969696]",children:"Loading organizational structure..."})})}):e.jsx(L,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#cccccc]",children:"Department Hierarchy"}),e.jsx("p",{className:"text-[#969696] mt-2",children:"Organizational structure and team relationships"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm text-[#969696]",children:[e.jsxs("div",{children:[x.length," departments"]}),e.jsxs("div",{children:[d.length," people"]})]})})]}),h&&e.jsxs(p,{className:"bg-red-500/20 border-red-500/50 p-4",children:[e.jsxs("div",{className:"text-red-400",children:["Error: ",h]}),e.jsx("button",{onClick:v,className:"mt-2 text-sm text-[#007acc] hover:text-[#1e90ff]",children:"Retry"})]}),x.length===0?e.jsx(p,{className:"bg-[#2d2d30] border-[#3e3e42] p-8 text-center",children:e.jsxs("div",{className:"text-[#969696]",children:[e.jsx("h3",{className:"text-lg mb-2",children:"No Departments"}),e.jsx("p",{children:"Create departments to see the organizational hierarchy"})]})}):e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6",children:[e.jsx("div",{className:"xl:col-span-3",children:e.jsxs(p,{className:"bg-[#2d2d30] border-[#3e3e42] p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#cccccc] mb-6",children:"Organizational Chart"}),e.jsx(Y,{departments:x,people:d,onDepartmentClick:o,selectedDepartmentId:s?.id})]})}),e.jsx("div",{className:"xl:col-span-1",children:e.jsx(p,{className:"bg-[#2d2d30] border-[#3e3e42] p-6 sticky top-6",children:s?e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-[#cccccc] mb-4",children:"Department Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-[#cccccc] mb-2",children:s.name}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"text-[#969696]",children:["Manager: ",e.jsx("span",{className:"text-[#cccccc]",children:s.managerName||"None assigned"})]}),e.jsxs("div",{className:"text-[#969696]",children:["Status: ",e.jsx("span",{className:s.isActive?"text-emerald-400":"text-gray-400",children:s.isActive?"Active":"Inactive"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-[#cccccc] mb-2",children:"Statistics"}),(()=>{const n=i(s);return e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"text-[#969696]",children:["Direct reports: ",e.jsx("span",{className:"text-[#cccccc]",children:n.directReports})]}),e.jsxs("div",{className:"text-[#969696]",children:["Sub-departments: ",e.jsx("span",{className:"text-[#cccccc]",children:n.subDepartments})]}),e.jsxs("div",{className:"text-[#969696]",children:["Total team size: ",e.jsx("span",{className:"text-[#cccccc]",children:n.totalTeamSize})]})]})})()]}),s.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-[#cccccc] mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-[#969696]",children:s.description})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-[#cccccc] mb-2",children:"Team Members"}),(()=>{const n=d.filter(u=>u.department===s.id);return n.length>0?e.jsx("div",{className:"space-y-2",children:n.map(u=>e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-[#cccccc]",children:u.name}),e.jsxs("div",{className:"text-[#969696] text-xs",children:[u.weeklyCapacity,"h capacity"]})]},u.id))}):e.jsx("div",{className:"text-sm text-[#969696]",children:"No team members assigned"})})()]})]})]}):e.jsxs("div",{className:"text-center text-[#969696]",children:[e.jsx("h3",{className:"text-lg mb-2",children:"Select a Department"}),e.jsx("p",{className:"text-sm",children:"Click on any department in the hierarchy to view details"})]})})})]})]})})},oe=()=>{const[x,w]=c.useState([]),[d,k]=c.useState([]),[s,D]=c.useState(4),[g,y]=c.useState(!0),[h,a]=c.useState(null),[v,o]=c.useState([]);c.useEffect(()=>{i()},[s]);const i=async()=>{try{y(!0),a(null);const[t,l,m]=await Promise.all([T.list(),F.list(),K.list()]),b=t.results||[],P=l.results||[],U=m.results||[];w(b),o(U);const R=await Promise.all(b.map(async M=>{const $=P.filter(j=>j.department===M.id);let z;try{z=await G.getDashboard(s,M.id?.toString())}catch(j){console.error(`Error loading dashboard data for department ${M.name}:`,j)}const r=$.reduce((j,E)=>j+(E.weeklyCapacity||36),0),N=z?.summary.avg_utilization||0,C=r-r*N/100,I=$.map(j=>j.id),O=U.filter(j=>I.includes(j.person)),H=new Map;O.filter(j=>j.skillType==="strength").forEach(j=>{const E=j.skillTagName||"Unknown";H.set(E,(H.get(E)||0)+1)});const W=Array.from(H.entries()).map(([j,E])=>({name:j,count:E})).sort((j,E)=>E.count-j.count).slice(0,5),Q=U.filter(j=>!I.includes(j.person)&&j.skillType==="strength").map(j=>j.skillTagName||"").filter(j=>!H.has(j)),J=[...new Set(Q)].slice(0,3);return{department:M,metrics:{teamSize:$.length,avgUtilization:N,peakUtilization:z?.summary.peak_utilization||0,totalAssignments:z?.summary.total_assignments||0,overallocatedCount:z?.summary.overallocated_count||0,availableHours:Math.max(0,C),utilizationTrend:"stable"},people:$,dashboardData:z,skills:{totalSkills:O.length,topSkills:W,uniqueSkills:H.size,skillGaps:J}}}));k(R)}catch(t){a(t.message||"Failed to load department reports")}finally{y(!1)}},n=t=>t<70?"text-emerald-400":t<=85?"text-blue-400":t<=100?"text-amber-400":"text-red-400",u=t=>{const{metrics:l}=t;let m=100;l.overallocatedCount>0&&(m-=l.overallocatedCount/l.teamSize*30),l.avgUtilization<70?m-=(70-l.avgUtilization)*.5:l.avgUtilization>85&&(m-=(l.avgUtilization-85)*1.5),l.teamSize<3&&(m-=10),m=Math.max(0,Math.min(100,m));let b="Excellent";return m<60?b="Needs Attention":m<75?b="Fair":m<90&&(b="Good"),{score:Math.round(m),status:b}};if(g)return e.jsx(L,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-[#969696]",children:"Generating department reports..."})})});const A=d.reduce((t,l)=>t+l.metrics.teamSize,0),f=d.length>0?d.reduce((t,l)=>t+l.metrics.avgUtilization,0)/d.length:0,S=d.reduce((t,l)=>t+l.metrics.availableHours,0);return e.jsx(L,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#cccccc]",children:"Department Reports"}),e.jsx("p",{className:"text-[#969696] mt-2",children:"Performance analytics and resource insights"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm text-[#969696]",children:"Timeframe:"}),e.jsx("div",{className:"flex gap-1",children:[1,2,4,8,12].map(t=>e.jsxs("button",{onClick:()=>D(t),className:`px-3 py-1 text-sm rounded transition-colors ${s===t?"bg-[#007acc] text-white":"bg-[#3e3e42] text-[#969696] hover:text-[#cccccc] hover:bg-[#4e4e52]"}`,children:[t,"w"]},t))})]})]}),h&&e.jsx(p,{className:"bg-red-500/20 border-red-500/50 p-4",children:e.jsxs("div",{className:"text-red-400",children:["Error: ",h]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Total Departments"}),e.jsx("div",{className:"text-2xl font-bold text-[#cccccc]",children:d.length})]}),e.jsxs(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Total People"}),e.jsx("div",{className:"text-2xl font-bold text-[#cccccc]",children:A})]}),e.jsxs(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Avg Utilization"}),e.jsxs("div",{className:`text-2xl font-bold ${n(f)}`,children:[f.toFixed(1),"%"]})]}),e.jsxs(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Available Capacity"}),e.jsxs("div",{className:"text-2xl font-bold text-emerald-400",children:[Math.round(S),"h"]})]})]}),e.jsx(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#cccccc] mb-4",children:"Department Performance Overview"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[#3e3e42]",children:[e.jsx("th",{className:"text-left text-sm font-medium text-[#969696] pb-3",children:"Department"}),e.jsx("th",{className:"text-left text-sm font-medium text-[#969696] pb-3",children:"Team Size"}),e.jsx("th",{className:"text-left text-sm font-medium text-[#969696] pb-3",children:"Utilization"}),e.jsx("th",{className:"text-left text-sm font-medium text-[#969696] pb-3",children:"Peak"}),e.jsx("th",{className:"text-left text-sm font-medium text-[#969696] pb-3",children:"Assignments"}),e.jsx("th",{className:"text-left text-sm font-medium text-[#969696] pb-3",children:"Available"}),e.jsx("th",{className:"text-left text-sm font-medium text-[#969696] pb-3",children:"Skills"}),e.jsx("th",{className:"text-left text-sm font-medium text-[#969696] pb-3",children:"Top Skills"}),e.jsx("th",{className:"text-left text-sm font-medium text-[#969696] pb-3",children:"Health"})]})}),e.jsx("tbody",{children:d.map(t=>{const l=u(t);return e.jsxs("tr",{className:"border-b border-[#3e3e42]/50",children:[e.jsx("td",{className:"py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-[#cccccc]",children:t.department.name}),e.jsx("div",{className:"text-xs text-[#969696]",children:t.department.managerName||"No manager"})]})}),e.jsx("td",{className:"py-3 text-[#cccccc]",children:t.metrics.teamSize}),e.jsx("td",{className:"py-3",children:e.jsx(V,{percentage:t.metrics.avgUtilization})}),e.jsx("td",{className:"py-3",children:e.jsxs("span",{className:n(t.metrics.peakUtilization),children:[t.metrics.peakUtilization.toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 text-[#cccccc]",children:t.metrics.totalAssignments}),e.jsxs("td",{className:"py-3 text-emerald-400",children:[Math.round(t.metrics.availableHours),"h"]}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-[#cccccc]",children:[t.skills.uniqueSkills," unique"]}),e.jsx("div",{className:"text-[#969696] text-xs",children:t.skills.skillGaps.length>0&&`${t.skills.skillGaps.length} gaps`})]})}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.skills.topSkills.slice(0,3).map((m,b)=>e.jsxs("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs",children:[m.name," (",m.count,")"]},b)),t.skills.topSkills.length>3&&e.jsxs("span",{className:"text-xs text-[#969696]",children:["+",t.skills.topSkills.length-3," more"]})]})}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm ${l.score>=90?"text-emerald-400":l.score>=75?"text-blue-400":l.score>=60?"text-amber-400":"text-red-400"}`,children:l.score}),e.jsx("span",{className:"text-xs text-[#969696]",children:l.status})]})})]},t.department.id)})})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#cccccc] mb-4",children:"Department Utilization Distribution"}),e.jsx("div",{className:"space-y-3",children:d.map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-[#cccccc]",children:t.department.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 h-2 bg-[#3e3e42] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${t.metrics.avgUtilization<70?"bg-emerald-400":t.metrics.avgUtilization<=85?"bg-blue-400":t.metrics.avgUtilization<=100?"bg-amber-400":"bg-red-400"}`,style:{width:`${Math.min(100,t.metrics.avgUtilization)}%`}})}),e.jsxs("span",{className:"text-sm text-[#969696] w-12 text-right",children:[t.metrics.avgUtilization.toFixed(0),"%"]})]})]},t.department.id))})]})}),e.jsx(p,{className:"bg-[#2d2d30] border-[#3e3e42]",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#cccccc] mb-4",children:"Available Resources"}),e.jsxs("div",{className:"space-y-3",children:[d.filter(t=>t.metrics.availableHours>0).sort((t,l)=>l.metrics.availableHours-t.metrics.availableHours).map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-[#cccccc]",children:t.department.name}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-emerald-400 font-medium",children:[Math.round(t.metrics.availableHours),"h available"]}),e.jsxs("div",{className:"text-xs text-[#969696]",children:[t.metrics.teamSize," people"]})]})]},t.department.id)),d.filter(t=>t.metrics.availableHours>0).length===0&&e.jsx("div",{className:"text-center text-[#969696] py-4",children:"No departments have available capacity"})]})]})})]})]})})};export{X as DepartmentForm,de as DepartmentsList,xe as HierarchyView,me as ManagerDashboard,oe as ReportsView};
//# sourceMappingURL=index.DH9lSSFF.js.map

import{j as e}from"./query.D2_a4YYZ.js";import{r as l}from"./react-vendor.BaVwoRKI.js";import{L as y,C as n}from"./Card.DBbmFfHk.js";import{U as L}from"./UtilizationBadge.CZolX8GJ.js";import{s as D,d as P,p as E,a as T}from"./api.BBwiE9lX.js";import"./router.BYkwE9TY.js";const O=({selectedSkills:s,onSkillsChange:p,placeholder:w="Filter by skills...",className:j="",maxDisplayedSkills:h=5})=>{const[g,c]=l.useState(!1),[d,u]=l.useState(""),[N,o]=l.useState([]),[b,i]=l.useState(!1),v=l.useRef(null);l.useEffect(()=>{_()},[]),l.useEffect(()=>{const a=r=>{v.current&&!v.current.contains(r.target)&&(c(!1),u(""))};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const _=async()=>{try{i(!0);const a=await D.list();o(a.results||[])}catch(a){console.error("Failed to load skills:",a)}finally{i(!1)}},x=N.filter(a=>a.name.toLowerCase().includes(d.toLowerCase())&&!s.includes(a.name)),k=a=>{p([...s,a]),u("")},z=a=>{p(s.filter(r=>r!==a))},f=()=>{p([])};return e.jsxs("div",{ref:v,className:`relative ${j}`,children:[e.jsxs("div",{className:"min-h-[42px] px-3 py-2 bg-[#3e3e42] border border-[#3e3e42] rounded text-[#cccccc] focus-within:border-[#007acc] cursor-text",onClick:()=>c(!0),children:[e.jsxs("div",{className:"flex flex-wrap gap-1 mb-1",children:[s.slice(0,h).map(a=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs",children:[a,e.jsx("button",{onClick:r=>{r.stopPropagation(),z(a)},className:"hover:text-blue-300 transition-colors",children:"×"})]},a)),s.length>h&&e.jsxs("span",{className:"px-2 py-1 bg-slate-500/20 text-slate-400 rounded text-xs",children:["+",s.length-h," more"]})]}),e.jsx("input",{type:"text",value:d,onChange:a=>u(a.target.value),onFocus:()=>c(!0),placeholder:s.length>0?"Add more skills...":w,className:"bg-transparent border-none outline-none text-[#cccccc] placeholder-[#969696] w-full text-sm"})]}),s.length>0&&e.jsx("button",{onClick:f,className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-[#969696] hover:text-[#cccccc] text-sm",children:"Clear all"}),g&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 max-h-48 bg-[#2d2d30] border border-[#3e3e42] rounded shadow-lg z-50 overflow-auto",children:[b&&e.jsx("div",{className:"px-3 py-2 text-sm text-[#969696]",children:"Loading skills..."}),!b&&x.length===0&&d&&e.jsxs("div",{className:"px-3 py-2 text-sm text-[#969696]",children:['No skills found matching "',d,'"']}),!b&&x.length===0&&!d&&s.length===N.length&&e.jsx("div",{className:"px-3 py-2 text-sm text-[#969696]",children:"All available skills selected"}),x.slice(0,10).map(a=>e.jsx("button",{onClick:()=>k(a.name),className:"w-full px-3 py-2 text-left text-sm text-[#cccccc] hover:bg-[#3e3e42] transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:a.name}),a.category&&e.jsx("span",{className:"text-xs text-[#969696]",children:a.category})]})},a.id)),x.length>10&&e.jsxs("div",{className:"px-3 py-2 text-xs text-[#969696] border-t border-[#3e3e42]",children:[x.length-10," more skills available..."]})]})]})},H=()=>{const[s,p]=l.useState(null),[w,j]=l.useState(!0),[h,g]=l.useState(null),[c,d]=l.useState(1),[u,N]=l.useState([]),[o,b]=l.useState(""),[i,v]=l.useState([]),[_,x]=l.useState([]);l.useEffect(()=>{f(),k(),z()},[c,o]);const k=async()=>{try{const t=await P.list();N(t.results||[])}catch(t){console.error("Error loading departments:",t)}},z=async()=>{try{const t=await E.list();x(t.results||[])}catch(t){console.error("Error loading people skills:",t)}},f=async()=>{try{j(!0),g(null);const t=await T.getDashboard(c,o||void 0);p(t)}catch(t){g(t.message||"Failed to load dashboard data")}finally{j(!1)}},a=t=>{t>=1&&t<=12&&d(t)},r=t=>i.length===0?t:t.filter(S=>{const A=_.filter(m=>m.person===S.id&&m.skillType==="strength").map(m=>m.skillTagName?.toLowerCase()||"");return i.some(m=>A.some(C=>C.includes(m.toLowerCase())||m.toLowerCase().includes(C)))});return w?e.jsx(y,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-[#969696]",children:"Loading dashboard..."})})}):h?e.jsx(y,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-red-400",children:["Error: ",h]}),e.jsx("button",{onClick:f,className:"bg-[#007acc] hover:bg-[#1e90ff] text-white px-4 py-2 rounded transition-colors",children:"Retry"})]})}):s?e.jsx(y,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#cccccc]",children:"Team Dashboard"}),e.jsxs("p",{className:"text-[#969696] mt-2",children:["Overview of team utilization and workload allocation",c===1?" (current week)":` (${c} week average)`,o&&e.jsxs("span",{className:"block mt-1",children:["Filtered by: ",u.find(t=>t.id?.toString()===o)?.name||"Unknown Department"]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm text-[#969696]",children:"Department:"}),e.jsxs("select",{value:o,onChange:t=>b(t.target.value),className:"px-3 py-1.5 text-sm bg-[#3e3e42] border border-[#3e3e42] rounded text-[#cccccc] focus:border-[#007acc] focus:outline-none min-w-[140px]",children:[e.jsx("option",{value:"",children:"All Departments"}),u.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm text-[#969696]",children:"Time Period:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1",max:"12",value:c,onChange:t=>a(parseInt(t.target.value)||1),className:"w-16 px-2 py-1 text-sm bg-[#3e3e42] border border-[#3e3e42] rounded text-[#cccccc] focus:border-[#007acc] focus:outline-none [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]"}),e.jsx("span",{className:"text-sm text-[#969696]",children:c===1?"week":"weeks"})]}),e.jsx("div",{className:"flex gap-1 ml-2",children:[1,2,4,8,12].map(t=>e.jsxs("button",{onClick:()=>a(t),className:`px-2 py-1 text-xs rounded transition-colors ${c===t?"bg-[#007acc] text-white":"bg-[#3e3e42] text-[#969696] hover:text-[#cccccc] hover:bg-[#4e4e52]"}`,children:[t,"w"]},t))})]})]})]}),i.length>0||s&&s.team_overview&&s.team_overview.length>0?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm text-[#969696] flex-shrink-0",children:"Filter by Skills:"}),e.jsx(O,{selectedSkills:i,onSkillsChange:v,placeholder:"Add skills filter...",className:"flex-grow max-w-md"}),i.length>0&&e.jsxs("div",{className:"text-xs text-blue-400 flex-shrink-0",children:["Showing ",r(s?.team_overview||[]).length," of ",s?.team_overview?.length||0," people"]})]}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs(n,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Total Team Members"}),e.jsx("div",{className:"text-2xl font-bold text-[#cccccc]",children:s.summary.total_people})]}),e.jsxs(n,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Average Utilization"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-400",children:[s.summary.avg_utilization,"%"]})]}),e.jsxs(n,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Peak Utilization"}),e.jsxs("div",{className:"text-2xl font-bold text-amber-400",children:[s.summary.peak_utilization,"%"]}),s.summary.peak_person&&e.jsx("div",{className:"text-xs text-[#969696] mt-1",children:s.summary.peak_person})]}),e.jsxs(n,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Active Assignments"}),e.jsx("div",{className:"text-2xl font-bold text-[#cccccc]",children:s.summary.total_assignments})]}),e.jsxs(n,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("div",{className:"text-[#969696] text-sm",children:"Overallocated"}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:s.summary.overallocated_count})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(n,{className:"lg:col-span-2 bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#cccccc] mb-4",children:"Team Overview"}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:r(s.team_overview).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#3e3e42]/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-[#cccccc]",children:t.name}),e.jsxs("div",{className:"text-sm text-[#969696]",children:[t.role," • ",t.allocated_hours,"h / ",t.capacity,"h"]}),c>1&&t.peak_utilization_percent!==t.utilization_percent&&e.jsxs("div",{className:"text-xs text-amber-400 mt-1",children:["Peak: ",t.peak_utilization_percent,"%",t.is_peak_overallocated&&" ⚠️"]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(L,{percentage:t.utilization_percent}),c>1&&t.peak_utilization_percent!==t.utilization_percent&&e.jsxs("div",{className:`text-xs px-2 py-1 rounded border ${t.is_peak_overallocated?"bg-red-500/20 text-red-400 border-red-500/30":t.peak_utilization_percent>85?"bg-amber-500/20 text-amber-400 border-amber-500/30":"bg-blue-500/20 text-blue-400 border-blue-500/30"}`,children:["Peak: ",t.peak_utilization_percent,"%"]})]})]},t.id))})]}),e.jsxs(n,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#cccccc] mb-4",children:"Available People"}),e.jsx("div",{className:"space-y-3",children:r(s.available_people).length===0?e.jsx("div",{className:"text-[#969696] text-sm",children:i.length>0?`No available people found with skills: ${i.join(", ")}`:"All team members are at capacity"}):r(s.available_people).map(t=>e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-[#cccccc] font-medium",children:t.name}),e.jsxs("div",{className:"text-emerald-400",children:[t.available_hours,"h available"]})]},t.id))})]})]}),e.jsxs(n,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#cccccc] mb-4",children:"Utilization Distribution"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-400",children:s.utilization_distribution.underutilized}),e.jsx("div",{className:"text-sm text-[#969696]",children:"Underutilized (<70%)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:s.utilization_distribution.optimal}),e.jsx("div",{className:"text-sm text-[#969696]",children:"Optimal (70-85%)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-400",children:s.utilization_distribution.high}),e.jsx("div",{className:"text-sm text-[#969696]",children:"High (85-100%)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:s.utilization_distribution.overallocated}),e.jsx("div",{className:"text-sm text-[#969696]",children:"Overallocated (>100%)"})]})]})]}),s.recent_assignments.length>0&&e.jsxs(n,{className:"bg-[#2d2d30] border-[#3e3e42]",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#cccccc] mb-4",children:"Recent Assignments"}),e.jsx("div",{className:"space-y-2",children:s.recent_assignments.map((t,S)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-[#3e3e42]/30 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[#cccccc] font-medium",children:t.person}),e.jsx("span",{className:"text-[#969696]",children:" assigned to "}),e.jsx("span",{className:"text-[#cccccc]",children:t.project})]}),e.jsx("div",{className:"text-[#969696] text-sm",children:new Date(t.created).toLocaleDateString()})]},S))})]})]})}):e.jsx(y,{children:e.jsx("div",{className:"text-[#969696]",children:"No dashboard data available"})})};export{H as default};
//# sourceMappingURL=Dashboard.CBZOYpor.js.map

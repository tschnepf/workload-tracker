# Unraid Compose project .env (example)
# Copy to your Unraid project .env path (e.g.,
#   /boot/config/plugins/compose.manager/projects/workload-tracker/.env)
# and fill in the secrets and host-specific values. Do not commit real secrets.

# --- Project metadata ---
COMPOSE_PROJECT_NAME=workload-tracker

# LAN host IP for convenience features (optional; used by settings to build CORS defaults)
# HOST_IP=10.20.30.2

# --- Database (containerized Postgres) ---
# Compose network hostname for the DB service (matches service name in docker-compose.unraid.yml)
POSTGRES_HOST=db
# Default Postgres port inside the Compose network
POSTGRES_PORT=5432
# Credentials and DB name
POSTGRES_DB=workload_tracker
POSTGRES_USER=workload_user
POSTGRES_PASSWORD=CHANGE_ME_DB_PASSWORD
# Optional: if you use a non-public schema, set it here
# Note: ensure your DATABASE_URL/search_path also targets this schema
DB_SCHEMA=public

# --- Database readiness tuning (used by backend entrypoint) ---
# Total seconds to wait for Postgres readiness before proceeding
DB_WAIT_TIMEOUT_SECS=120
# Sleep between readiness checks (seconds)
DB_WAIT_SLEEP_SECS=1

# Celery Beat schedule file (must be writable inside the container).
# Using tmpfs avoids permission issues with non-root containers on Unraid.
CELERY_BEAT_SCHEDULE_FILE=/tmp/celery/beat-schedule

# --- Redis ---
REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD

# --- Frontend (Vite) build args passed via compose build args ---
# With SWAG proxying /api to the backend, use a relative base so the SPA and API share origin.
FRONTEND_API_URL=/api
# Under HTTPS, prefer cookie-based refresh flow
FRONTEND_COOKIE_REFRESH_AUTH=true

# --- Backend (Django) runtime settings ---
# Enable cookie-based refresh and enforce HTTPS in production behind SWAG
COOKIE_REFRESH_AUTH=true
SECURE_SSL_REDIRECT=true

# --- Risk Attachments (protected storage) ---
# Store outside MEDIA_ROOT; mount a dedicated volume at this path in Docker.
RISK_ATTACHMENTS_DIR=/app/risk_attachments
# Optional upload size cap in bytes (default 100 MiB if unset)
# RISK_UPLOAD_MAX_BYTES=104857600

# Control whether the backend runs migrations automatically on start
RUN_MIGRATIONS_ON_START=true

# Hosts and CSRF for your public domain (no quotes, no spaces in ALLOWED_HOSTS)
# Always allowed internally: localhost,127.0.0.1 (for container health checks)
ALLOWED_HOSTS=smc-projects.com,www.smc-projects.com
CSRF_TRUSTED_ORIGINS=https://smc-projects.com,https://www.smc-projects.com

# Optional CORS knobs (normally not needed when using same-origin /api through SWAG)
# CORS_ALLOWED_ORIGINS=
# CORS_ALLOW_ALL_ORIGINS=false

# --- App URL used in emails (frontend base) ---
# EMAIL_DOMAIN takes precedence when building links. You can set a bare domain or full URL.
EMAIL_DOMAIN=smc-projects.com
# Fallback/base URL if EMAIL_DOMAIN is not set
APP_BASE_URL=https://smc-projects.com

# --- Email (SMTP) ---
# For Gmail, enable 2FA and use an App Password. Do NOT use your normal password.
# If omitted, the backend uses console email in DEBUG; in Unraid/production, configure SMTP here.
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=true
EMAIL_HOST_USER=youraccount@gmail.com
EMAIL_HOST_PASSWORD=YOUR_16_CHAR_APP_PASSWORD
DEFAULT_FROM_EMAIL=Workload Tracker <youraccount@gmail.com>
SERVER_EMAIL=youraccount@gmail.com
EMAIL_TIMEOUT=10

# Sentry (optional)
# SENTRY_DSN=

# Notes:
# - After changing FRONTEND_* values, rebuild the frontend image:
#     docker compose -f docker-compose.unraid.yml build frontend && \
#     docker compose -f docker-compose.unraid.yml up -d frontend
# - Backend picks up env changes on restart:
#     docker compose -f docker-compose.unraid.yml up -d backend
